
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer
local tier = localPlayer:GetAttribute("Tier")
local Remote = ReplicatedStorage.Signals.RemoteEvents:FindFirstChild("GetWoolRemote")
local instantkill = false
local autobuy = false
local automerge = false
local autoupgrade = false
local buyamount = 1
local buyamounts = {1,3,10,30,50,100,1000,10000}
local tycoon
for _,v in workspace.Tycoon.Tycoons:GetChildren() do
    if v.Owner.Value == localPlayer then
        tycoon = v
    end
end
local gun 
if tool and tool:FindFirstChild("GunClient") and tool:FindFirstChild("Configuration") then
    gun = tool
end

-- UI Setup
local ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
ScreenGui.Name = "ClaimGUI"

--UI redesign
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 400, 0, 320)
Frame.Position = UDim2.new(0, 50, 0, 50)
Frame.BackgroundColor3 = Color3.fromRGB(36, 37, 42)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = false
Frame.BackgroundTransparency = 0.05
Frame.ClipsDescendants = true
Frame.ZIndex = 2

-- Add drop shadow
local Shadow = Instance.new("ImageLabel", Frame)
Shadow.Image = "rbxassetid://1316045217"
Shadow.Size = UDim2.new(1, 30, 1, 30)
Shadow.Position = UDim2.new(0, -15, 0, -15)
Shadow.BackgroundTransparency = 1
Shadow.ImageTransparency = 0.7
Shadow.ZIndex = 1

-- Top Bar for Dragging
local TopBar = Instance.new("TextButton", Frame)
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.Position = UDim2.new(0, 0, 0, 0)
TopBar.BackgroundColor3 = Color3.fromRGB(28, 29, 34)
TopBar.Text = "Merge Tower Defense - By Dev-Jay"
TopBar.TextColor3 = Color3.fromRGB(200, 200, 255)
TopBar.Font = Enum.Font.GothamBold
TopBar.TextSize = 22
TopBar.AutoButtonColor = false
TopBar.BorderSizePixel = 0
TopBar.ZIndex = 3
TopBar.TextXAlignment = Enum.TextXAlignment.Center
TopBar.TextYAlignment = Enum.TextYAlignment.Center
TopBar.BackgroundTransparency = 0.1
TopBar.ClipsDescendants = true
TopBar.TextStrokeTransparency = 0.8
TopBar.TextStrokeColor3 = Color3.fromRGB(0,0,0)
TopBar.TextWrapped = true
TopBar.UICorner = Instance.new("UICorner", TopBar)
TopBar.UICorner.CornerRadius = UDim.new(0, 8)

-- Section Headers
local function makeHeader(text, y)
    local lbl = Instance.new("TextLabel", Frame)
    lbl.Size = UDim2.new(0, 180, 0, 22)
    lbl.Position = UDim2.new(0, 20, 0, y)
    lbl.BackgroundTransparency = 1
    lbl.Text = text
    lbl.TextColor3 = Color3.fromRGB(180, 180, 200)
    lbl.Font = Enum.Font.GothamSemibold
    lbl.TextSize = 16
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.ZIndex = 3
    return lbl
end
makeHeader("Toggles", 55)
makeHeader("Automation", 145)
makeHeader("Settings", 235)

-- Helper for button style
local function styleBtn(btn, color)
    btn.BackgroundColor3 = color or Color3.fromRGB(50, 50, 80)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.BorderSizePixel = 0
    btn.TextSize = 17
    btn.Font = Enum.Font.Gotham
    btn.AutoButtonColor = true
    btn.ZIndex = 4
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 8)
    local stroke = Instance.new("UIStroke", btn)
    stroke.Color = Color3.fromRGB(80,80,120)
    stroke.Thickness = 1
    stroke.Transparency = 0.5
    btn.MouseEnter:Connect(function()
        btn.BackgroundColor3 = Color3.fromRGB(70, 70, 120)
    end)
    btn.MouseLeave:Connect(function()
        btn.BackgroundColor3 = color or Color3.fromRGB(50, 50, 80)
    end)
end

-- Column layout positions
local col1x, col2x = 20, 210
local rowh = 40

-- Instantkill Toggle
InstantKillBtn = Instance.new("TextButton", Frame)
InstantKillBtn.Size = UDim2.new(0, 170, 0, rowh)
InstantKillBtn.Position = UDim2.new(0, col1x, 0, 80)
InstantKillBtn.Text = "üíÄ Instantkill: OFF"
styleBtn(InstantKillBtn, Color3.fromRGB(100, 40, 40))
InstantKillBtn.MouseButton1Click:Connect(function()
    instantkill = not instantkill
    InstantKillBtn.Text = instantkill and "üíÄ Instantkill: ON" or "üíÄ Instantkill: OFF"
    InstantKillBtn.TextColor3 = instantkill and Color3.fromRGB(255,80,80) or Color3.new(1,1,1)
    if instantkill then
        game.StarterGui:SetCore("SendNotification", {Title="Instantkill", Text="Instantkill enabled!", Duration=2})
    else
        game.StarterGui:SetCore("SendNotification", {Title="Instantkill", Text="Instantkill disabled!", Duration=2})
    end
end)

-- Autobuy, Automerge, Autoupgrade Buttons
if AutobuyBtn then AutobuyBtn:Destroy() end
if AutomergeBtn then AutomergeBtn:Destroy() end
if AutoupgradeBtn then AutoupgradeBtn:Destroy() end
AutobuyBtn = Instance.new("TextButton", Frame)
AutobuyBtn.Size = UDim2.new(0, 170, 0, rowh)
AutobuyBtn.Position = UDim2.new(0, col1x, 0, 170)
AutobuyBtn.Text = "Autobuy: OFF"
styleBtn(AutobuyBtn)
AutobuyBtn.MouseButton1Click:Connect(function()
    _G.autobuy = not _G.autobuy
    AutobuyBtn.Text = "Autobuy: "..(_G.autobuy and "ON" or "OFF")
    AutobuyBtn.BackgroundColor3 = _G.autobuy and Color3.fromRGB(80, 120, 80) or Color3.fromRGB(50, 50, 80)
end)
AutomergeBtn = Instance.new("TextButton", Frame)
AutomergeBtn.Size = UDim2.new(0, 170, 0, rowh)
AutomergeBtn.Position = UDim2.new(0, col2x, 0, 170)
AutomergeBtn.Text = "Automerge: OFF"
styleBtn(AutomergeBtn)
AutomergeBtn.MouseButton1Click:Connect(function()
    _G.automerge = not _G.automerge
    AutomergeBtn.Text = "Automerge: "..(_G.automerge and "ON" or "OFF")
    AutomergeBtn.BackgroundColor3 = _G.automerge and Color3.fromRGB(80, 120, 80) or Color3.fromRGB(50, 50, 80)
end)
AutoupgradeBtn = Instance.new("TextButton", Frame)
AutoupgradeBtn.Size = UDim2.new(0, 170, 0, rowh)
AutoupgradeBtn.Position = UDim2.new(0, col2x, 0, 215)
AutoupgradeBtn.Text = "Autoupgrade: OFF"
styleBtn(AutoupgradeBtn)
AutoupgradeBtn.MouseButton1Click:Connect(function()
    _G.autoupgrade = not _G.autoupgrade
    AutoupgradeBtn.Text = "Autoupgrade: "..(_G.autoupgrade and "ON" or "OFF")
    AutoupgradeBtn.BackgroundColor3 = _G.autoupgrade and Color3.fromRGB(80, 120, 80) or Color3.fromRGB(50, 50, 80)
end)

-- Buyamount Dropdown
if BuyAmountDropdown then BuyAmountDropdown:Destroy() end
BuyAmountDropdown = Instance.new("TextButton", Frame)
BuyAmountDropdown.Size = UDim2.new(0, 170, 0, rowh)
BuyAmountDropdown.Position = UDim2.new(0, col2x, 0, 80)
BuyAmountDropdown.Text = "Buy Amount: "..tostring(buyamount)
styleBtn(BuyAmountDropdown, Color3.fromRGB(60, 60, 90))
local dropdownOpen = false
local dropdownFrame
BuyAmountDropdown.MouseButton1Click:Connect(function()
    if dropdownOpen then
        if dropdownFrame then dropdownFrame:Destroy() end
        dropdownOpen = false
        return
    end
    dropdownOpen = true
    dropdownFrame = Instance.new("Frame", Frame)
    dropdownFrame.Size = UDim2.new(0, 170, 0, #buyamounts*28)
    dropdownFrame.Position = UDim2.new(0, col2x, 0, 120)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(50,50,70)
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.ZIndex = 5
    local corner = Instance.new("UICorner", dropdownFrame)
    corner.CornerRadius = UDim.new(0, 8)
    for i,amt in ipairs(buyamounts) do
        local opt = Instance.new("TextButton", dropdownFrame)
        opt.Size = UDim2.new(1,0,0,28)
        opt.Position = UDim2.new(0,0,0,(i-1)*28)
        opt.Text = tostring(amt)
        styleBtn(opt, Color3.fromRGB(60,60,90))
        opt.MouseButton1Click:Connect(function()
            buyamount = amt
            BuyAmountDropdown.Text = "Buy Amount: "..tostring(amt)
            dropdownFrame:Destroy()
            dropdownOpen = false
        end)
    end
end)

-- SpeedBox and Auto Claim Toggle
if SpeedBox then SpeedBox:Destroy() end
SpeedBox = Instance.new("TextBox", Frame)
SpeedBox.Size = UDim2.new(0, 170, 0, rowh)
SpeedBox.Position = UDim2.new(0, col1x, 0, 260)
SpeedBox.PlaceholderText = "Claims/sec (e.g. 100)"
SpeedBox.Text = "100"
SpeedBox.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
SpeedBox.TextColor3 = Color3.new(1, 1, 1)
SpeedBox.BorderSizePixel = 0
SpeedBox.TextSize = 17
SpeedBox.Font = Enum.Font.Gotham
local corner = Instance.new("UICorner", SpeedBox)
corner.CornerRadius = UDim.new(0, 8)

if Toggle then Toggle:Destroy() end
Toggle = Instance.new("TextButton", Frame)
Toggle.Size = UDim2.new(0, 170, 0, rowh)
Toggle.Position = UDim2.new(0, col2x, 0, 260)
Toggle.Text = "‚ñ∂ Start Auto Claim"
styleBtn(Toggle, Color3.fromRGB(50, 50, 80))
Toggle.MouseButton1Click:Connect(function()
    running = not running
    Toggle.Text = running and "‚è∏ Stop Auto Claim" or "‚ñ∂ Start Auto Claim"
    if running then
        task.spawn(function()
            while running do
                local speed = tonumber(SpeedBox.Text) or 100
                for _ = 1, speed do
                    Remote:FireServer(tier)
                end
                task.wait(1)
            end
        end)
    end
end)

if KillUIButton then KillUIButton:Destroy() end
KillUIButton = Instance.new("TextButton", Frame)
KillUIButton.Size = UDim2.new(0, 360, 0, 32)
KillUIButton.Position = UDim2.new(0, 20, 0, 305)
KillUIButton.Text = "‚úñ Close & Reset UI"
styleBtn(KillUIButton, Color3.fromRGB(120, 40, 40))
KillUIButton.TextSize = 18
KillUIButton.Font = Enum.Font.GothamBold
KillUIButton.MouseButton1Click:Connect(function()
    instantkill = false
    _G.autobuy = false
    _G.automerge = false
    _G.autoupgrade = false
    running = false
    buyamount = 1
    InstantKillBtn.Text = "üíÄ Instantkill: OFF"
    InstantKillBtn.TextColor3 = Color3.new(1,1,1)
    AutobuyBtn.Text = "Autobuy: OFF"
    AutobuyBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
    AutomergeBtn.Text = "Automerge: OFF"
    AutomergeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
    AutoupgradeBtn.Text = "Autoupgrade: OFF"
    AutoupgradeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
    BuyAmountDropdown.Text = "Buy Amount: 1"
    Toggle.Text = "‚ñ∂ Start Auto Claim"
    ScreenGui:Destroy()
end)

spawn(function()
    while true do
        if _G.autobuy and tycoon then
            local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()
            firetouchinterest(tycoon.Buttons_E["Add"..buyamount].Head, char.HumanoidRootPart, 0)
            firetouchinterest(tycoon.Buttons_E["Add"..buyamount].Head, char.HumanoidRootPart, 1)
        end
        if _G.automerge and tycoon then
            local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()
            firetouchinterest(tycoon.Buttons_E.Merge.Head, char.HumanoidRootPart, 0)
            firetouchinterest(tycoon.Buttons_E.Merge.Head, char.HumanoidRootPart, 1)
        end
        if _G.autoupgrade and tycoon then
            local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()
            firetouchinterest(tycoon.Buttons_E.Upgrade.Head, char.HumanoidRootPart, 0)
            firetouchinterest(tycoon.Buttons_E.Upgrade.Head, char.HumanoidRootPart, 1)
        end
        wait(0.2)
    end
end)

spawn(function()
    while true do
        if instantkill and gun and tycoon and tycoon:FindFirstChild("Round") then
            for i = 1,10 do
                for _,v in ipairs(tycoon.Round:GetChildren()) do
                    if v:FindFirstChild("Humanoid") then
                        v.Humanoid.Health = 0
                    end
                end
            end
        end
        wait(0.5)
    end
end)
